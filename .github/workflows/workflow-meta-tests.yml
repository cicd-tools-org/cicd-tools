---
name: cicd-tooling-github-workflow-meta-tests

on:
  push:
  workflow_dispatch:

#  secrets:
#    SLACK_WEBHOOK:
#      description: "Optional, enables Slack notifications."
#      required: false

jobs:

  configuration:
    uses: ./.github/workflows/.job-00-cookiecutter.yml
    with:
      PATH: "cookiecutter.json"

  send_notification_test_success:
    runs-on: ubuntu-latest
    steps:
      - name: Notification (Local Action Test) -- Checkout Repository
        uses: actions/checkout@v3

      - name: Notification (Local Action Test) -- Setup Environment
        run: |
          source "./.github/scripts/step-setup-environment.sh" "true"
        shell: bash

      - name: Notification (Local Action Test) -- Run Notification Action (Testing Locally)
        uses: ./.github/actions/action-00-notification
        with:
          NOTIFICATION_EMOJI: ":vertical_traffic_light:"
          NOTIFICATION_MESSAGE: "testing workflow has started!"
          NOTIFICATION_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}

  send_notification_test_failure:
    runs-on: ubuntu-latest
    steps:
      - name: Notification (Local Action Test) -- Checkout Repository
        uses: actions/checkout@v3

      - name: Notification (Local Action Test) -- Setup Environment
        run: |
          source "./.github/scripts/step-setup-environment.sh" "true"
        shell: bash

      - name: Notification (Local Action Test) -- Run Notification Action (Testing Locally)
        uses: ./.github/actions/action-00-notification
        with:
          NOTIFICATION_EMOJI: ":heavy_check_mark:"
          NOTIFICATION_MESSAGE: "local notification script is working!"
          NOTIFICATION_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
          TESTING_MODE: true

  security_test_failure:
    needs: [configuration]
    secrets: inherit
    uses: ./.github/workflows/.job-10-security.yml
    with:
      CONFIGURATION: ${{ needs.configuration.outputs.CONFIGURATION }}
      TESTING_MODE: true

  documentation_test_failure:
    needs: [configuration]
    secrets: inherit
    uses: ./.github/workflows/.job-30-documentation.yml
    with:
      CONFIGURATION: ${{ needs.configuration.outputs.CONFIGURATION }}
      TESTING_MODE: true

  pre-commit_test_failure:
    needs: [configuration]
    secrets: inherit
    uses: ./.github/workflows/.job-50-precommit.yml
    with:
      CONFIGURATION: ${{ needs.configuration.outputs.CONFIGURATION }}
      TEMPLATE_SCENARIO: "0.toml_linting-0.workflow_linting"
      TESTING_MODE: true

  commit_lint_test_failure:
    needs: [configuration]
    secrets: inherit
    uses: ./.github/workflows/.job-80-commit-lint.yml
    with:
      CONFIGURATION: ${{ needs.configuration.outputs.configuration }}
      TESTING_MODE: true

  shell_lint_test_failure:
    needs: [configuration]
    secrets: inherit
    uses: ./.github/workflows/.job-80-shell-lint.yml
    with:
      CONFIGURATION: ${{ needs.configuration.outputs.configuration }}
      TESTING_MODE: true

  toml_lint_test_failure:
    needs: [configuration]
    secrets: inherit
    uses: ./.github/workflows/.job-80-toml-lint.yml
    with:
      CONFIGURATION: ${{ needs.configuration.outputs.configuration }}
      TESTING_MODE: true

  workflow_lint_test_failure:
    needs: [configuration]
    secrets: inherit
    uses: ./.github/workflows/.job-80-workflow-lint.yml
    with:
      CONFIGURATION: ${{ needs.configuration.outputs.configuration }}
      TESTING_MODE: true

  yaml_lint_test_failure:
    needs: [configuration]
    secrets: inherit
    uses: ./.github/workflows/.job-80-yaml-lint.yml
    with:
      CONFIGURATION: ${{ needs.configuration.outputs.configuration }}
      TEMPLATE_SCENARIO: "0.toml_linting-0.workflow_linting"
      TESTING_MODE: true

  create_release_test_failure:
    needs: [configuration]
    secrets: inherit
    uses: ./.github/workflows/.job-99-create-release.yml
    with:
      CONFIGURATION: ${{ needs.configuration.outputs.configuration }}
      TESTING_MODE: true

  success:
    needs: [commit_lint_test_failure, create_release_test_failure, documentation_test_failure, pre-commit_test_failure, security_test_failure, send_notification_test_failure, send_notification_test_success, shell_lint_test_failure, toml_lint_test_failure, workflow_lint_test_failure, yaml_lint_test_failure]
    runs-on: ubuntu-latest
    steps:
      - name: Notification (Local Action Test) -- Checkout Repository
        uses: actions/checkout@v3

      - name: Notification (Local Action Test) -- Setup Environment
        run: |
          source "./.github/scripts/step-setup-environment.sh" "true"
        shell: bash

      - name: Notification (Local Action Test) -- Run Notification Action (Testing Locally)
        uses: ./.github/actions/action-00-notification
        with:
          NOTIFICATION_EMOJI: ":checkered_flag:"
          NOTIFICATION_MESSAGE: "all tests have passed successfully!"
          NOTIFICATION_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
          TESTING_MODE: true
